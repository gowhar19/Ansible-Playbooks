---
 - name: Get the VMware Vcenter VM List
   hosts: localhost
   gather_facts: false
   connection: local

   tasks:
    - name: VCenter login
      uri:
         url: "https://{{ vcenter_ip }}/rest/com/vmware/cis/session"
         user: "{{ vcenter_user }}"
         password: "{{ vcenter_pass }}"
         force_basic_auth: yes
         method: POST
         validate_certs: no
      register: login_vc


    - name:  Get the List of Virtual Machines
      uri:
         url: "https://{{ vcenter_ip }}/rest/vcenter/vm"
         force_basic_auth: yes
         validate_certs: no
         headers:
          cookie: "{{ login_vc.set_cookie }}"
      register: get_vms_list


    - name: Display all VM names from VCenter
      debug:
         msg: "{{ item.name }}"
      with_items: "{{ get_vms_list.json.value }}"
...

      